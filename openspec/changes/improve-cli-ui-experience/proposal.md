# CLIユーザーエクスペリエンス改善提案

## Why

現在のCLIインターフェースは機能的には完全ですが、実務運用の観点で以下の課題があります:

1. **進行状況の不透明性**: 長時間の処理（Neo4j保存、PDF生成など）で進捗が見えない
2. **入力ミス時の不親切性**: エラー後に最初からやり直しが必要で、部分的な修正ができない
3. **結果の視覚化不足**: 計算結果はテーブル表示のみで、視覚的な理解が難しい
4. **対話モードの使いにくさ**: 必須・オプションの項目の区別が不明確で、入力をスキップできない
5. **ヘルプ情報の不足**: コマンド実行中の操作ガイドや例が少ない
6. **実務フローとの不一致**: 相続放棄など後日判明する情報に対応できず、最初から全情報が必要
7. **確定後の追加情報不足**: 相続人確定後に必要な連絡先（住所）情報を入力できない

特に6, 7は実務において重大な問題です。相続手続きでは、調査開始時点で全情報が揃っていることは稀であり、段階的に情報を追加・更新していく必要があります。

これらの改善により、実務家（司法書士、弁護士など）の日常業務での使用効率が大幅に向上します。

## What Changes

### 1. プログレスバー・インジケーターの追加
- Neo4j保存、ファイル読み込み、PDF生成などの長時間処理に進捗表示
- Rich libraryのProgressを活用
- 処理ステップの明確化（例: "1/4 データ検証中..."）

### 2. インタラクティブプロンプトの改善
- 必須項目とオプション項目の明示
- デフォルト値の提示とスキップ機能
- **ペンディング（保留）機能**: 後日判明する情報（相続放棄、相続欠格など）を「未確定」として保留可能
- 入力値のリアルタイム検証と即座のフィードバック
- 確認画面での修正機能（選択的な項目再入力）
- **段階的な情報追加**: セッション再開時に保留項目の更新が可能

### 3. 結果表示の強化
- 家系図のインライン表示（ASCIIアート）
- カラーコーディングによる相続順位の視覚化
- 相続割合の視覚的表現（プログレスバー形式）
- サマリー情報の強調表示

### 4. コマンド補完とヘルプの拡充
- インタラクティブモード中のショートカット表示
- 各入力フィールドでの例示と説明
- エラーメッセージの改善（何が問題で、どう修正すべきか）

### 5. セッション管理機能
- 対話モードの中断・再開機能
- 入力途中のデータ一時保存
- 履歴からの再実行
- **保留項目の管理**: 未確定情報をマークし、後日更新可能

### 6. 相続人確定後の追加情報入力
- **連絡先情報の入力機能**: 確定した相続人の住所・電話番号・メールアドレスを入力
- 相続人情報の拡張モデル対応（Person モデルへの連絡先フィールド追加）
- 出力レポート（PDF/Markdown）への連絡先情報の反映
- Neo4j保存時の連絡先情報の永続化

## Impact

**Affected specs:**
- `cli-interface` (新規作成)
- `data-models` (MODIFIED - Person モデルへの連絡先フィールド追加)

**Affected code:**
- `src/cli/main.py` - セッション管理機能、保留項目管理の追加
- `src/cli/commands.py` - プログレス表示、確認画面、連絡先入力の追加
- `src/cli/display.py` - 表示機能の強化
- `src/models/person.py` - **連絡先情報フィールドの追加（address, phone, email）**
- `src/database/repositories.py` - 連絡先情報の保存・読み込み対応
- `src/cli/report_generator.py` - レポートへの連絡先情報出力
- `examples/demo_interactive.py` - 対話型デモの改善（保留機能、連絡先入力）

**Breaking changes:**
- Person モデルへのフィールド追加（オプショナルフィールドのため後方互換性維持）
- Neo4j スキーマ拡張（既存データとの互換性維持、マイグレーション不要）

**Benefits:**
- ユーザーの入力ミスによる再入力時間の削減（推定50%削減）
- 処理待ち時間中の不安解消
- 視覚的な理解向上による確認作業の効率化
- **実務フローとの整合性向上**: 段階的な情報収集・更新に対応
- **連絡先一元管理**: 相続人の連絡先をシステム内で一元管理可能
- **レポート品質向上**: 連絡先情報を含む完全なレポート出力
- 業務効率向上による実務家の満足度向上

**Risks:**
- Rich libraryの依存関係の増加（すでに使用中のため影響小）
- セッション管理のストレージ領域（一時ファイル）の必要性
- Person モデルの拡張による既存データとの互換性（オプショナルフィールドのため影響最小）
- 保留項目の管理複雑化（適切な状態管理が必要）
